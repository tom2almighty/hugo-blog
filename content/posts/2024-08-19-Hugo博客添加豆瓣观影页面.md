---
title : 'Hugoåšå®¢æ·»åŠ è±†ç“£è§‚å½±é¡µé¢'
date : 2024-08-19T18:00:09+08:00
description: "é€šè¿‡ GitHub doumark-action ä¿å­˜è±†ç“£è§‚å½±æ•°æ®ï¼Œå¹¶ç»™ Hugo åšå®¢æ·»åŠ è±†ç“£è§‚å½±é¡µé¢ã€‚"
featured_image: ""
tags: ["Hugo","è±†ç“£"]
categories: å»ºç«™
slug: hugo-douban
---



<!--more-->
## å‰è¨€
`Hexo` æœ‰ [hexo-douban](https://github.com/mythsman/hexo-douban) é¡¹ç›®ï¼Œå¯ä»¥æ·»åŠ è§‚å½±æ•°æ®åˆ°é¡µé¢ï¼Œæ›´æ¢ `Hugo` åä¹Ÿæƒ³æ·»åŠ ä¸€ä¸ªè§‚å½±é¡µé¢ï¼ŒæŸ¥æ‰¾èµ„æ–™åå‘ç°æœ‰ä¸€ä¸ª `doumark-action` é¡¹ç›®å¯ä»¥å°†è§‚å½±æ•°æ®ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œç„¶åå¯ä»¥é€šè¿‡ Hugo çš„å‡½æ•°è·å–æ•°æ®ï¼Œå†å‰ç«¯å±•ç¤ºï¼Œå‰é¢çš„æ–‡ç« ä¸­å·²ç»æ·»åŠ äº†è±†ç“£æ¡ç›®çš„çŸ­ä»£ç ï¼Œè¿™ç¯‡æ–‡ç« å†è¡¥å……ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯è¿‘æœŸè§‚å½±çš„çŸ­ä»£ç ï¼Œå¦å¤–æ˜¯æ·»åŠ ä¸€ä¸ªæµ·æŠ¥å¢™é¡µé¢ã€‚
æœ€ç»ˆå®ç°çš„æ ·å¼å¸ƒå±€å‚è€ƒäº†ä¸€äº›åšä¸»çš„æ–‡ç« å’Œä»“åº“ä»£ç ï¼š
- [Hugo ã€Œè¿‘æœŸã€çŸ­ä»£ç ï¼ˆåŸºäº Doumark Actionsï¼‰](https://immmmm.com/hugo-shortcodes-recently-by-douban/)
- [Koobaiåšå®¢](https://koobai.com/movies/)
- [å…ƒåŸ¹çš„å…ƒè§†è§’](https://blog.yuanpei.me/)

## ä¿å­˜æœ¬åœ°æ•°æ®
ç”±äºè±†ç“£ `API` çš„é™åˆ¶ï¼Œä¹‹å‰çš„ä¸€äº›åœ¨çº¿è·å–æ•°æ®æ–¹å¼å·²ç»å¤±æ•ˆäº†ï¼Œå¯ä»¥é€šè¿‡åœ¨çº¿çˆ¬å–æ ‡è®°çš„æ•°æ®åˆ°æœ¬åœ°ï¼Œç„¶åæ“ä½œæœ¬åœ°çš„æ•°æ®æ–‡ä»¶ï¼Œå†å‰ç«¯å±•ç¤ºæ•°æ®ã€‚
ç”¨åˆ°çš„é¡¹ç›®æ˜¯ [doumark-action](https://github.com/lizheming/doumark-action)ã€‚
é¦–å…ˆåœ¨åšå®¢ä»“åº“çš„æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª `Workflow`ï¼Œæ–°å»º `.github/workflows/douban.yml `æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å†™å…¥è‡ªå·±æƒ³è¦ä¿å­˜çš„æ•°æ®ï¼Œå½±éŸ³ã€ä¹¦ç±ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åˆ° `Notion`ï¼Œé¡¹ç›®æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œè¿™é‡Œè´´ä¸€ä¸‹æˆ‘çš„é…ç½®ï¼Œå…¶ä¸­å°† `id` æ”¹ä¸ºè‡ªå·±çš„è±†ç“£ `ID`ã€‚
```yaml
# .github/workflows/douban.yml
name: douban
on: 
  schedule:
  - cron: "30 * * * *"
  workflow_dispatch:

jobs:
  douban:
    name: Douban mark data sync
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: movie
      uses: lizheming/doumark-action@master
      with:
        id: 222317686
        type: movie
        format: csv
        dir: ./doubanSync/douban
    
    - name: book
      uses: lizheming/doumark-action@master
      with:
        id: 222317686
        type: book
        format: csv
        dir: ./doubanSync/douban
  
    - name: Commit
      uses: EndBug/add-and-commit@v8
      with:
        message: 'chore: update douban data'
        add: './doubanSync/douban'
```
{{< notice notice-tip >}}
æˆ‘è¿™é‡Œå°†æ•°æ®å­˜æ”¾çš„ç›®å½•æ”¹ä¸ºäº†åšå®¢ `~/data` ç›®å½•ä¹‹å¤–çš„åœ°æ–¹ï¼Œä½¿ç”¨åšå®¢æ ¹ç›®å½•ä¸‹çš„ `data` ç›®å½•ä¸€ç›´æŠ¥é”™ï¼Œå‘ç°[ä¹‹å‰](https://discourse.gohugo.io/t/csv-unexpected-data-type-string-in-file/17421/3)ä¹Ÿæœ‰äººå‡ºç°åŒç±»å‹çš„é”™è¯¯ï¼Œæ›´æ”¹ç›®å½•åå°±æ­£å¸¸äº†ã€‚
{{< /notice >}}

ä¹‹åå¯ä»¥åœ¨ä»“åº“æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹ `action`ï¼Œå®Œæˆåä¼šåœ¨ `~/doubanSync/douban/` ç”Ÿæˆ `movie.csv` å’Œ `book.csv` ï¼Œè¿™å°±æ˜¯ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶ã€‚
## è¿‘æœŸè§‚å½±çŸ­ä»£ç 
### é…ç½®
è¦æ·»åŠ çŸ­ä»£ç éœ€è¦åœ¨ `~/layouts/shortcodes/` ç›®å½•ä¸‹æ–°å»ºçŸ­ä»£ç æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™é‡Œä¸º `recent-douban.html`ï¼Œåœ¨å…¶ä¸­æ·»åŠ æ¨¡æ¿å…ƒç´ ï¼š
```html
{{ $type := .Get "type" }}
{{ $count := .Get "count" | default 4 }}
{{ $count = add $count 1 }}
{{ $items := slice }}

{{ if eq $type "movies" }}
    {{ $items = getCSV "," "doubanSync/douban/movie.csv" }}
{{ else if eq $type "books" }}
    {{ $items = getCSV "," "doubanSync/douban/book.csv" }}
{{ end }}



<div class="recent-items">
    {{ range $idx, $item := first $count $items }}
        {{ if ne $idx 0 }}
            {{ $rating := float (index $item 6) }}
            <div class="recent-item">
                <div class="recent-item-cover">
                    <img class="avatar" src="{{ index $item 3 }}" referrer-policy="no-referrer" loading="lazy" alt="{{ index $item 9 }}" title="{{ index $item 1 }}" width="150" height="220">
                </div>
                <div class="recent-douban-rating">
                    <div class="rating">
                        <span class="allstardark">
                            <span class="allstarlight" style="width:{{ mul 10 $rating }}%"></span>
                        </span>
                        <span class="rating_nums">{{ $rating }}</span>
                    </div>
                </div>
                <div class="recent-item-title">
                    <a rel="noreferrer" href="{{ index $item 5 }}" target="_blank">{{ index $item 1 }}</a>
                </div>
            </div>
        {{ end }}
    {{ end }}
</div>
```
ç„¶åæ·»åŠ ä¸€ä¸‹æ ·å¼ä»£ç ï¼Œè¿™é‡Œå’Œä¹‹å‰çš„æ–‡ç« ä¿æŒä¸€è‡´ï¼Œæ·»åŠ åˆ° `shortcodes.scss` ä¸­ï¼š
```scss
.recent-items {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin: 15px;
}
.recent-items .recent-item, .recent-items .recent-item img {
    margin-bottom: 10px;
}
```
{{< notice notice-info >}}
ä¹‹å‰çš„è±†ç“£æ¡ç›®çŸ­ä»£ç æ ·å¼æ–‡ä»¶å·²ç»æ·»åŠ äº†è¯„åˆ†æ˜Ÿçº§çš„æ ·å¼ `allstarlight`ï¼Œæ‰€ä»¥è¿™é‡Œä¸æ·»åŠ ï¼Œå¦‚æœä¹‹å‰æ²¡æ·»åŠ è¿‡çš„è¯éœ€è¦æ·»åŠ ç›¸å…³çš„æ ·å¼ï¼Œåœ¨ä¹‹å‰çš„æ–‡ç« å¯ä»¥æ‰¾åˆ°ã€‚
{{< /notice >}}
### ä½¿ç”¨
ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
```
{\{< recent-douban type="movies" count=8 >}\}
{\{< recent-douban type="books" >}\}
```
é»˜è®¤å±•ç¤ºå››æ¡æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ `count` å‚æ•°æŒ‡å®šæ˜¾ç¤ºçš„æ•°é‡ã€‚

**é¢„è§ˆ**:

{{< recent-douban type="movies" >}}
{{< recent-douban type="books" >}}

## è§‚å½±é¡µé¢
### é…ç½®
æ·»åŠ ä¸€ä¸ªæµ·æŠ¥å¢™é¡µé¢å±•ç¤ºæ‰€æœ‰çš„è§‚å½±ä¿¡æ¯ï¼Œé»˜è®¤å±•ç¤º `18` æ¡ä¿¡æ¯ã€‚
é¦–å…ˆåœ¨ `~/lauouts/_default/` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ¨¡æ¿æ–‡ä»¶ï¼Œè¿™é‡Œä¸º `posterwall.html`ï¼Œç„¶ååœ¨å…¶ä¸­æ·»åŠ é¡µé¢å…ƒç´ ï¼š
```html
{{ define "main" }}
<div class="post-list-container post-list-container-shadow">
<div class="post-item-wrapper post-item-wrapper-no-hover">
    <div class="post-item post-item-no-gaps">
    <div class="post-item-info-wrapper">
        <div class="post-item-title post-item-title-small">
        {{.Title}}
        <div class="posterwall-description">
            {{ .Params.description | markdownify }}
        </div>
        <div class="movie-wall">
            {{ $items := getCSV "," "doubanSync/douban/movie.csv" }}
            {{ range $idx, $item := $items }}
                {{ if ne $idx 0 }}
                {{ $rating := float (index $item 6) }}
                <div class="movie-item" style="display: none;">
                    <div class="movie-cover">
                    <img src="{{ index $item 3 }}" alt="{{ index $item 1 }}" loading="lazy" width="200" referrer-policy="no-referrer">
                    <div class="movie-info">
                        <div class="movie-title"><a rel="noreferrer" href="{{ index $item 5 }}" target="_blank">{{ index $item 1 }}</a></div>
                        <div class="movie-rating">
                            <div class="rating">
                                <span class="allstardark">
                                    <span class="allstarlight" style="width:{{ mul 10 $rating }}%"></span>
                                </span>
                                <span class="rating_nums">{{ index $item 6 }}</span>
                            </div>
                        </div>


                        <div class="movie-card">{{ index $item 12 }}</div>
                        <div class="movie-comment">{{ index $item 9 }}</div>
                    </div>
                    </div>
                </div>
                {{ end }}
            {{ end }}
            </div>
            
            <button id="loadMore">åŠ è½½æ›´å¤š</button>
        </div>
    </div>
    </div>
</div>
</div>


<script>
  let visibleMovies = 18;
  const movieItems = document.querySelectorAll('.movie-item');
  const loadMoreButton = document.getElementById('loadMore');

  function updateVisibility() {
    movieItems.forEach((movie, idx) => {
      movie.style.display = idx < visibleMovies ? 'block' : 'none';
    });

    if (visibleMovies >= movieItems.length) {
      loadMoreButton.style.display = 'none';
    }
  }

  loadMoreButton.addEventListener('click', () => {
    visibleMovies += 18;
    updateVisibility();
  });

  updateVisibility();
</script>
{{ end }}
```
{{< notice notice-info >}}
ä»£ç ä¸­åŒ…æ‹¬äº†é¡µé¢å…ƒç´ å’ŒåŠ è½½æ›´å¤šæ•°æ®çš„ `js` ä»£ç ï¼Œå¹¶ä¸”åœ¨é¡µé¢æ ‡é¢˜ä¸‹æ·»åŠ äº†ä¸€ä¸ªé¡µé¢æè¿°ï¼Œæ–¹ä¾¿åœ¨ markdown æ–‡ä»¶ä¸­æ›´æ”¹æè¿°ä¿¡æ¯ï¼Œä¹Ÿä¾¿äºè°ƒæ•´æ ·å¼ã€‚åŒæ ·é¡µé¢ä¸­è¯„åˆ†æ˜Ÿçº§çš„å‘½å `allstarlight` ä¹Ÿæ˜¯ä¸ä¹‹å‰è±†ç“£æ¡ç›®çŸ­ä»£ç ä¸€è‡´ï¼Œæ–¹ä¾¿ä¸€èµ·è°ƒæ•´ã€‚
{{< /notice >}}
å®Œæˆååœ¨ `custom.scss` ä¸­æ·»åŠ æ ·å¼ä»£ç ï¼š
```scss
// ç”µå½±æµ·æŠ¥å¢™æ ·å¼
.posterwall-description {
  margin: 10px;
  text-align: center;
}
.movie-wall {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 3px;
  padding: 3px;
}

.movie-item {
  width: 100%;
  margin-bottom: 0;
}

.movie-cover {
  position: relative;
  overflow: hidden;
  aspect-ratio: 2 / 3;
}

.movie-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.movie-info {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  padding: 10px;
  opacity: 0;
  transition: opacity 0.3s ease;
  overflow: auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.movie-cover:hover img {
  transform: scale(1.1);
}

.movie-cover:hover .movie-info {
  opacity: 1;
}

#loadMore {
  display: block;
  margin: 20px auto;
  padding: 10px 20px;
  background-color: lighten($color-accent,0.1);
  color: white;
  border: none;
  cursor: pointer;
}

#loadMore:hover {
  background-color: gray;
}

.movie-info .movie-rating {
  display: flex;
  align-items: center;
  margin-top: 3px;
  margin-bottom: 3px;
}
.movie-info .movie-rating .rating .rating_nums {
  font-size: 1.0em;
  color: #fff;
}

.movie-info .movie-card {
  margin: 5px 0;
  font-size: 0.7em;
  color: #fff;
}

.movie-info .movie-comment {
  margin: 5px 0;
  font-size: 0.7em;
  color: #fff;
}
```
### ä½¿ç”¨
åœ¨ `content` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `posterwall.md` æ–‡ä»¶ï¼Œ`Front Matter` ä¿¡æ¯å¡«å†™å¦‚ä¸‹ï¼Œæ ‡é¢˜å¯æè¿°å¯ä»¥è‡ªç”±æ›´æ”¹ï¼š
```yaml
---
title: æµ·æŠ¥å¢™
layout: "posterwall"
description: "è¿™é‡Œæ˜¯æˆ‘å·²è§‚çœ‹ç”µå½±çš„æµ·æŠ¥å¢™ï¼Œæ•°æ®æ¥æºäºè±†ç“£ã€‚"
---
```
æ·»åŠ åå°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªèœå•é¡µé¢æ¥æŒ‡å‘æµ·æŠ¥å¢™ï¼Œæœ€ç»ˆæ•ˆæœå¯ä»¥è®¿é—® ğŸ‘‰ [è§‚å½±é¡µé¢](https://blog.grew.cc/posterwall)


## å‚è€ƒ
- [Hugo ã€Œè¿‘æœŸã€çŸ­ä»£ç ï¼ˆåŸºäº Doumark Actionsï¼‰](https://immmmm.com/hugo-shortcodes-recently-by-douban/)
- [Koobaiåšå®¢](https://koobai.com/movies/)
- [å…ƒåŸ¹çš„å…ƒè§†è§’](https://blog.yuanpei.me/)
- [è±†ç“£ä¹¦å½±éŸ³åŒæ­¥ GitHub Action](https://imnerd.org/doumark.html)
- [CSV: unexpected data type [][]string in file](https://discourse.gohugo.io/t/csv-unexpected-data-type-string-in-file/17421/3)